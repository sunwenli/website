+++

date = "2019-09-25"
draft = false
tags = ["zipalign","electron","mac"]

title = "Mac app å†…é›†æˆå¹¶è°ƒç”¨ zipalign æŠ¥é”™ dyld: Library not loaded: @rpath/libc++.dylib"

+++

æ‰“åŒ…å·¥å…·(mac ç‰ˆ)å¢åŠ äº† electron å†…ç½®çš„è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼Œå‰ææ˜¯å¿…é¡»å¯¹ app ç­¾åæ‰è¡Œã€‚ä»Šå¤©äº¤ç»™å®‰å“ç»„åŒå­¦è¯•ç”¨æ—¶å‡ºé—®é¢˜äº†ğŸ˜‚ã€‚

ä½¿ç”¨æ‰“åŒ…å·¥å…·å†…é›†æˆçš„ zipalign(ä¸€ä¸ªå¯¹å®‰å“ apk ä¼˜åŒ–çš„å·¥å…·)å¯¹ apk ä¼˜åŒ–æ—¶æŠ¥é”™äº†ã€‚

```
Error:

dyld: Library not loaded: @rpath/libc++.dylib
  Referenced from: myAppName.app/Contents/Resources/tool/mac/zipalign
  Reason: image not found
```

å¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯ zipalign å¼•ç”¨åŠ¨æ€åº“ libc++.dylib ä¸”æ²¡æœ‰æ‰¾åˆ°è¯¥åº“å¯¼è‡´çš„ã€‚
æ‰¾ä¸åˆ°çš„åŸå› åœ¨äº `@rpath`,å¯¹ `@rpath` çš„è§£é‡Šå¯ä»¥å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](http://www.tanhao.me/pieces/1361.html/)

è¯´ç™½äº† `@rpath` æ˜¯ä¸€ä¸ªç±»ä¼¼ shell ä¸­çš„å˜é‡, zipalign åœ¨è¿è¡Œæ—¶ä¼šä» `@rpath` å–å‡ºç›¸åº”çš„å€¼ç„¶åæ‹¼æ¥åˆ° `/libc++.dylib`

äº‹å®ä¸Šï¼Œ`@rpath` åœ¨è¿™é‡Œå¯¹åº”çš„å€¼æ˜¯ `/usr/lib`ï¼Œé‚£ä¸ºä»€ä¹ˆ zipalign æ‰¾ä¸åˆ°è¿™ä¸ªåº“ï¼ŒåŸå› åœ¨[è¿™ç¯‡æ–‡ç« ](https://developer.apple.com/library/archive/documentation/Security/Conceptual/CodeSigningGuide/Procedures/Procedures.html#//apple_ref/doc/uid/TP40005929-CH4-SW19)å¯ä»¥æ‰¾åˆ°ã€‚

ç®€å•æ¥è¯´ï¼Œæ˜¯è‹¹æœä¸ºäº†é˜²æ­¢ç¬¬ä¸‰æ–¹æ¶æ„ä¿®æ”¹ app åŠ äº†ä¸€é“é˜²å¾¡å¢™ï¼Œä¸å…è®¸ app å†…éƒ¨åŠ è½½åŠ¨æ€åº“æˆ–è„šæœ¬ã€‚è¿™äº›éƒ½é™äºç­¾åçš„æ­£å¼ app,æœªç­¾åçš„ app ä¸å—é™åˆ¶ã€‚

æ‰¾åˆ°äº†é—®é¢˜çš„åŸå› ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è§£å†³äº†ã€‚

æˆ‘ä»¬ç»§ç»­

`install_name_tool` è¿™ä¸ªå·¥å…·æ˜¯ä¸“é—¨æ“ä½œ appå†…çš„åŠ¨æ€åº“é…ç½®çš„ã€‚

åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

`install_name_tool -change @rpath/libc++.dylib /usr/lib/libc++.dylib myAppName.app/Contents/Resources/tool/mac/zipalign`

è¿™æ ·å°±æŠŠ zipalign å†…æ‰¾åŠ¨æ€åº“çš„é“¾æ¥æ”¹å¥½äº†ã€‚

é™„ä¸Š `install_name_tool` çš„ç®€å•ä½¿ç”¨è¯´æ˜ ï¼š

> æŸ¥çœ‹ `install_name_tool` æ”¯æŒå“ªäº›å‚æ•°

```
install_name_tool -h
```

```
Usage: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/install_name_tool
 [-change old new] ... [-rpath old new] ... [-add_rpath new] ... [-delete_rpath old] ... [-id name] input
```

> ä¿®æ”¹åŠ¨æ€åº“è·¯å¾„

```
install_name_tool -change <appå†…çš„@rpathå€¼> <çœŸå®çš„è·¯å¾„å€¼> <appè·¯å¾„>
```

å…¶ä½™çš„å‘½ä»¤æš‚æ—¶æ²¡ç”¨åˆ°ï¼Œå’±ä¹Ÿä¸çŸ¥é“å•¥ä½œç”¨^^ã€‚

å‚è€ƒé“¾æ¥

1. [MACï¼š@rpathçš„å‘](https://www.jianshu.com/p/bfa05ef3c482)
2. [Xcode Build Settingsä¸­çš„å˜é‡@rpath,@loader_path,@executable_path](http://www.tanhao.me/pieces/1361.html/)
3. [install_name_toolè§£å†³dyld: Library not loaded](https://blog.csdn.net/minger1202/article/details/71319308)

***
